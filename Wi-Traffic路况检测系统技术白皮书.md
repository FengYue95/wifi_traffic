# Wi-Traffic路况检测系统技术白皮书

[TOC]

## [1. ]()概述

### [1.1. ]()研发背景

​	随着中国城市化的迅速发展，城市人口快速增加，城市道路交通面临的压力越来越大，交通拥堵为广大市民出行带来很多不便，不合理的道路设计和反应滞后的道路监控引导系统难以适应越来越严峻交通现状。为了缓解城市交通日益增加的压力，应对交通突发事件，制定交通疏导方案等，都需要研究分析城市的交通路况数据。目前，交通路况的获取方式在国内外主要有GPS浮动车法，传感器获取，视频监控获取等。GPS浮动车法通过在志愿车辆（如公交车，出租车等）上安装GPS设备收集位置信息及移动方向与速度信息，通过大量的数据得到某个路段的交通情况。；传感器获取法是一种传统的路况获取方法，通过在马路上安装传感线圈，压力传感器等设备来检测过往车辆数目和速度；视频监控法是通过在道路关键地方安装摄像设备，拍摄道路上的交通图像和视频，传到后台借助图像识别等算法得到各项交通指标。

​	虽然以上几种方法都应用比较广泛，技术也较为成熟，但在实际应用中也有一些缺点。与此同时，随着智能移动设备和移动互联网在中国大小城市基本普及，各种新兴的移动端应用为人们日常生活带来了许多便利，也极大的丰富了人们的精神生活，人们与移动设备的交互已经成为日常生活不可或缺的一个环节。目前移动端上网的方式主要有移动数据流量上网和Wi-Fi上网。数据流量上网优点是信号覆盖范围大，随时随地上网，但费用比较高。而Wi-Fi虽然还不能做到信号全覆盖，但随着技术的成熟和设备成本降低，Wi-Fi网络的普及率和覆盖率也日益增高，最大的优点是Wi-Fi上网费用极低，大多数Wi-Fi接入点都是免费的使得大多数用户在有Wi-Fi可用的情况下，会优先使用Wi-Fi上网。

### [1.2. ]()产品定位

​	鉴于现有交通路况获取方式的缺点，本文尝试采用一种低成本易维护对环境适应性强的方法来获取交通路况。因为很多用户随身携带移动设备，并且会经常使用Wi-Fi功能，而且很多用户在开启Wi-Fi后，没有及时关闭Wi-Fi的习惯，这为我们利用Wi-Fi数据进行交通路况研究提供了良好的客观环境和有利的前提条件。当用户的移动设备开启Wi-Fi功能时，设备会定时主动扫描附近Wi-Fi接入点，发出请包含可作为移动设备唯一识别标识的mac地址的请求包。如果将经过技术改造的Wi-Fi接入点部署在城市路网的各个关键地点，捕捉经过接入点附近的移动设备Wi-Fi请求包，解析这些请求包，就可以获得移动设备的位置信息和设备信息，对移动终端进行定位。基于Wi-Fi定位展开数据分析与挖掘，可以获得多项道路交通指标，通过进一步的数据分析与整合，可以得到较为准确的交通路况信息。

## [2. ]()产品方案功能介绍

### [2.1. ]()系统架构图

![img](file:///C:\Users\MOONSH~1\AppData\Local\Temp\msohtmlclip1\01\clip_image002.jpg)

​									图2-1 Wi-Triffic系统架构图

- **服务器**

​         **软件环境：**Linux Ubuntu系统

​         **硬件环境：**内存4G及以上，CPU双核心以上，可用磁盘容量30G及以上

- **本地Windows** **电脑**

​        **软件环境：**操作系统：Windows XP及以上

​                           浏览器：InternetExplorer 6.0以上版本或chrome浏览器

​        **硬件环境：**CPU：无硬性要求

​                           内存：无硬性要求

- **Android** **手机**

  **软件环境：**安卓4.0及以上，GPS及4G网络可用

​       **硬件环境：**内存512M及以上

### 2.2. 系统构成描述

​	数据采集部分通过Wi-Fi探针完成，系统后台和数据处理部分主要由python完成，路网数据表存储于MySQL数据库，原始数据保存于文件系统，计算结果存储与mongodb。路网建模部分采集端通过移动端app采集探针位置并上传，后台采用python tornado的web 框架来完成路网数据建模入库。

## [3. ]()产品方案技术介绍

### 3.1. 数据采集与回传

​	对便携式Wi-Fi无线路由器的嵌入式程序进行修改，使用便携式Wi-Fi无线路由器从当探针。探针与USB无线网卡连接，每20秒往服务器回传捕捉到的设备Wi-Fi请求包解析数据。服务器接收数据，为每个探针创建一个文件夹并以探针mac命名，探针文件夹里存放每天的捕获数据，以年月日（YYMMDD）命名。

![https://wifitraffic.github.io/wifi_traffic/index_files/clip_image004b41e3c4b-1263-449e-93b7-d57816470088.jpg](file:///C:\Users\MOONSH~1\AppData\Local\Temp\msohtmlclip1\01\clip_image004.jpg)

​						    图3-1 数据文件内数据格式：mac|rssi|timestamp

* **字段说明：**

  **mac**: 被检测设备mac

  **rssi**：信号强度

  **timestamp**：时间戳

### 3.2. 同一地点多探针检测与数据融合

​	按照指定的部署原则将Wi-Fi探针的部署在路网的关键地方（如十字路口，景区出入口，高速出入口等）。针对大型路口，由于单个Wi-Fi探针辐射范围、采集数据能力有限，因此采用多个（至少两个）探针对过往移动设备进行检测。采用地点编码，将同一地点探针编在同一组内，组内数据融合成一个数据集，等价于多个探针合并成一个能覆盖整个路口的超级探针，避免大型路口数据因单一探针辐射能力有限而丢失数据。

### 3.3. 定位点位置纠正

​	由于Wi-Fi探针辐射范围较大，直接以Wi-Fi探针位置标记移动设备误差较大。根据距离在不同rssi情况下的概率分布，可以估计移动设备与探针的距离，并映射到路网道路上的对应位置。

![img](file:///C:\Users\MOONSH~1\AppData\Local\Temp\msohtmlclip1\01\clip_image006.jpg)
​						      	图3-2 不同RSSI情况下距离概率密度分布

### 3.4. 速度约束与均值过滤器

​	对于短时间内位置变化特别大的设备记录进行发现，主要通过速度约束条件，与其前后速度均值比较，把瞬时出现异常高速（高于最大限速）的记录过滤掉。

### 3.5. 人车分离

​	由于探针捕捉到的请求来源包括行人与车辆上的人的移动设备，而能够反映路况是车辆数据而不是行人数据，行人数据会对路况计算造成干扰，应该去除。

​	通过特征工程，提取当前被捕获设备的速度，回溯历史数据，提取该批设备历史速度，历史速度方差，过去指定时间内的运动半径等作为特征，采用决策树和kmeans算法来处理人车混杂情况下的人车分离。 

### 3.6. 数据存储

​	系统存储的数据包括两部分：

* **路网数据：**

  路网数据结构规整，字段数目固定，适宜存在关系型数据库，本系统使用mysql存储。

  【**Location表**】

![https://wifitraffic.github.io/wifi_traffic/index_files/ccb9ef0e-f28a-446c-8e18-da91e92e2deb.png](file:///C:\Users\MOONSH~1\AppData\Local\Temp\msohtmlclip1\01\clip_image008.gif)

​									图3-3 Location表字段说明

![https://wifitraffic.github.io/wifi_traffic/index_files/daa09787-fe0a-4a3d-b361-807c0541333c.png](file:///C:\Users\MOONSH~1\AppData\Local\Temp\msohtmlclip1\01\clip_image010.gif)

​								             图3-4 location表示例

​	【**Roadnet表**】

![img](file:///C:\Users\MOONSH~1\AppData\Local\Temp\msohtmlclip1\01\clip_image012.jpg)

​									图3-5 roadnet表字段说明

![img](file:///C:\Users\MOONSH~1\AppData\Local\Temp\msohtmlclip1\01\clip_image014.jpg)

​								           图3-6 roadnet表示例

* **计算结果数据：**

  字段不固定，记录格式自由，随着路网布点变化易于拓展，使用mongodb存储。计算结果数据主要包含以下若干路况指标：

  * **路段拥堵指数**

    该接口用于返回某条路段拥堵指数的数据。通过URL请求，传入路段的编号，返回该路段的拥堵指数。

  * **路段拥堵等级**

    该接口用于返回某条路段的拥堵等级。通过URL请求,传入路段的编号，返回该路段的拥堵等级。

  * **路段车流量**

    该接口用于返回某条路段的车流量。通过URL请求，传入路段的编号，返回该路段的车流量。

  * **区域拥堵指数**

    该接口用于返回某区域内整体拥堵指数的数据。通过URL请求，传入区域的编号，返回该区域的拥堵指数。

  * **全天拥堵指数**

    该接口用于返回某一天各个时刻的全网拥堵指数。通过URL请求，返回某一天各个时刻的全网拥堵指数。

  * **全天路段速度**

    该接口用于返回一天内各个时段每条路段的速度。通过URL请求，传入日期，格式20161010，返回全天内5分钟为间隔的多个时间点对应的所有路段的速度。

  * **全网拥堵指数**

    该接口用于返回当前时刻全路网拥堵指数的数据。通过URL请求，无需传入参数，返回全路网的拥堵指数。

  * **全网拥堵比率**

    该接口用于返回当前时刻全路网拥堵比率的数据。通过URL请求，无需传入参数，返回全路网的拥堵比率。

### 3.7. 可视化路网建模技术

​	利用前端技术和百度地图经纬度拾取的api，开发出一个可视化的布点建模工具，通过可视化的调节从布点人员专用定位app上传的探针位置，在后台数据库生成路网信息数据库。 

### 3.8. 用户数据接口API开发

​	基于tornado框架开发的REST风格的数据接口，支持一部高并发访问。

## [4. ]()测评数据

​	提供了仿真测试数据，也经过北京北三环部分路段实地测试。
